<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Resoluci√≥n de Problemas</title>
  <style>
    /* --------- Reset y base --------- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', system-ui, -apple-system, Arial, sans-serif;
      background: linear-gradient(135deg, #fbeaff, #dff6ff, #fff4e6);
      min-height: 100vh;                 /* Permite que el body haga scroll si hace falta */
      padding: 16px;                     /* Respira en bordes */
    }

    /* --------- Caja principal --------- */
    .container {
      background: #fff;
      color: #444;
      max-width: 760px;
      width: 100%;
      margin: 0 auto;
      padding: 24px;
      border-radius: 20px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    h1 {
      font-family: Georgia, 'Times New Roman', serif;
      font-size: clamp(1.4rem, 2.2vw, 1.9rem);
      margin: 0 0 4px 0;
      color: #3f3f3f;
      text-align: center;
    }

    p { margin: 0 0 12px 0; color: #555; line-height: 1.5; }

    /* --------- Campos --------- */
    input[type="text"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #d9d9d9;
      border-radius: 12px;
      font-size: 1rem;
      outline: none;
    }
    textarea { min-height: 120px; resize: vertical; }

    .checkbox-group {
      text-align: left;
      max-width: 520px;
      margin: 0 auto;
    }
    .checkbox-group label {
      display: block;
      margin: 8px 0;
      cursor: pointer;
    }

    /* --------- Navegaci√≥n --------- */
    .navigation {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-top: 4px;
    }
    .navigation button {
      flex: 1 1 160px;
      background: #7c5cff;
      border: none;
      color: white;
      padding: 12px 18px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1rem;
      transition: background .2s ease, transform .05s ease;
    }
    .navigation button:hover { background: #5a3fd4; }
    .navigation button:active { transform: translateY(1px); }
    .navigation button:disabled { background: #cfcfcf; cursor: not-allowed; }

    /* --------- Lista de causas --------- */
    .cause-wrap { text-align: left; }
    .hint { font-size: .95rem; opacity: .85; margin-bottom: 8px; }
    .cause-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      border: 1px solid #e6e6e6;
      border-radius: 10px;
      margin: 6px 0;
      background: #fafafa;
    }
    .cause-item button {
      background: #ff4d4f;
      border: none;
      color: #fff;
      padding: 6px 10px;
      border-radius: 8px;
      font-size: .9rem;
      cursor: pointer;
    }
    .saved-badge {
      display: inline-block;
      font-size: .9rem;
      padding: 6px 10px;
      border-radius: 999px;
      background: #e6ffed;
      color: #197a30;
      border: 1px solid #bbf0c7;
      margin-top: 8px;
    }

    /* --------- Responsive --------- */
    @media (max-width: 600px) {
      .container { padding: 18px; }
      .checkbox-group { max-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="title">Cu√©ntame tu problema</h1>
    <div id="content"></div>

    <div class="navigation">
      <button id="prevBtn" disabled>‚¨ÖÔ∏è Atr√°s</button>
      <button id="nextBtn">Siguiente ‚û°Ô∏è</button>
    </div>
  </div>

  <script>
    /* ======================
       Datos base
    ====================== */
    const topics = [
      "Mec√°nico", "De Salud", "Jardiner√≠a", "Econ√≥mico", "Mantenimiento del hogar",
      "Social", "Tecnolog√≠a", "Educativo", "Legal", "Alimentaci√≥n", "Transporte", "Otro"
    ];

const questions = {
  "Mec√°nico": [
    {q:"¬øQu√© funci√≥n cumple la bater√≠a en un auto?", a:"Proveer energ√≠a el√©ctrica", o:["Almacenar combustible","Regular la presi√≥n de los frenos"]},
    {q:"¬øQu√© parte convierte energ√≠a mec√°nica en el√©ctrica?", a:"Alternador", o:["Carburador","Radiador"]},
    {q:"¬øQu√© l√≠quido se revisa para evitar que el motor se recaliente?", a:"Refrigerante", o:["Aceite","L√≠quido de frenos"]},
    {q:"¬øQu√© mide el tac√≥metro?", a:"Revoluciones del motor", o:["Velocidad del veh√≠culo","Temperatura"]},
    {q:"Si se rompe la correa de distribuci√≥n:", a:"Puede da√±ar v√°lvulas y pistones", o:["El auto arranca m√°s r√°pido","No afecta nada"]},
    {q:"¬øQu√© componente limpia el aire que entra al motor?", a:"Filtro de aire", o:["Filtro de aceite","Filtro de combustible"]},
    {q:"¬øQu√© significa ABS?", a:"Sistema de frenos antibloqueo", o:["Aire forzado","Asistencia b√°sica de seguridad"]},
    {q:"Si falla el alternador:", a:"La bater√≠a no se recarga", o:["El motor deja de girar","Se pierden los frenos"]},
    {q:"¬øQu√© pieza transmite fuerza del motor a las ruedas?", a:"Caja de cambios", o:["Buj√≠a","Radiador"]}
  ],
  "De Salud": [
    {q:"¬øQu√© es la hipertensi√≥n?", a:"Presi√≥n arterial elevada", o:["Presi√≥n arterial baja","Frecuencia card√≠aca alta"]},
    {q:"¬øQu√© vitamina se produce con la exposici√≥n al sol?", a:"Vitamina D", o:["Vitamina C","Vitamina B12"]},
    {q:"El IMC sirve para:", a:"Evaluar el estado nutricional", o:["Medir la presi√≥n arterial","Diagnosticar diabetes"]},
    {q:"¬øCu√°l es un s√≠ntoma de anemia?", a:"Cansancio extremo", o:["Dolor de cabeza","Aumento de apetito"]},
    {q:"La glucosa alta indica:", a:"Posible diabetes", o:["Hipoglucemia","Hidrataci√≥n insuficiente"]},
    {q:"Para prevenir infecciones:", a:"Lavarse las manos frecuentemente", o:["Evitar dormir","Beber mucho caf√©"]},
    {q:"La fiebre es:", a:"Elevaci√≥n de la temperatura corporal", o:["Baja de la presi√≥n","Dolor en m√∫sculos"]},
    {q:"Un colesterol alto puede afectar:", a:"Coraz√≥n y arterias", o:["Ri√±ones","H√≠gado exclusivamente"]},
    {q:"¬øQu√© significa ECG?", a:"Electrocardiograma", o:["Ecograf√≠a card√≠aca","Examen de glucosa"]}
  ],
  "Jardiner√≠a": [
    {q:"¬øQu√© planta necesita poca agua?", a:"Suculenta", o:["Rosa","Tomate"]},
    {q:"¬øQu√© es el compost?", a:"Abono org√°nico", o:["Tipo de flor","Plaga vegetal"]},
    {q:"La fotos√≠ntesis ocurre en:", a:"Hojas", o:["Ra√≠ces","Tallos"]},
    {q:"¬øCu√°l es una herramienta de jardiner√≠a?", a:"Tijeras de podar", o:["Destornillador","Martillo"]},
    {q:"¬øQu√© se poda en primavera?", a:"Ramas secas", o:["Semillas","Hierba alta"]},
    {q:"El riego por goteo sirve para:", a:"Ahorrar agua", o:["Aumentar humedad","Cortar plantas"]},
    {q:"El pH del suelo se mide para:", a:"Saber acidez o alcalinidad", o:["Medir temperatura","Medir luz"]},
    {q:"¬øQu√© es mulch?", a:"Capa de protecci√≥n sobre la tierra", o:["Fertilizante l√≠quido","Plaga"]},
    {q:"Una planta perenne:", a:"Vive varios a√±os", o:["Vive un a√±o","No florece nunca"]}
  ],
  "Econ√≥mico": [
    {q:"¬øQu√© es inflaci√≥n?", a:"Aumento general de precios", o:["Reducci√≥n de salarios","Aumento de impuestos"]},
    {q:"El PIB mide:", a:"Producci√≥n de un pa√≠s", o:["Poblaci√≥n total","Reservas bancarias"]},
    {q:"Un pr√©stamo tiene:", a:"Intereses", o:["Descuento","Salario extra"]},
    {q:"Diversificar inversiones sirve para:", a:"Reducir riesgos", o:["Aumentar deudas","Evitar impuestos"]},
    {q:"Mercado de acciones:", a:"Compra y venta de acciones", o:["Pr√©stamos bancarios","Mercado de divisas"]},
    {q:"¬øQu√© es liquidez?", a:"Facilidad de convertir en efectivo", o:["Cantidad de bienes","N√∫mero de empleados"]},
    {q:"Deflaci√≥n es:", a:"Bajada general de precios", o:["Aumento de impuestos","Incremento salarial"]},
    {q:"¬øQu√© es un presupuesto?", a:"Plan de gastos e ingresos", o:["Balance bancario","Renta fija"]},
    {q:"Tasa de inter√©s:", a:"Costo de pedir dinero prestado", o:["Precio de acciones","Valor del d√≥lar"]}
  ],
  "Mantenimiento del hogar": [
    {q:"Para destapar un ca√±o puedes usar:", a:"Desatascador", o:["Aspiradora","Martillo"]},
    {q:"La pintura al agua se limpia con:", a:"Agua", o:["Aceite","Alcohol"]},
    {q:"¬øQu√© evita la humedad en paredes?", a:"Impermeabilizante", o:["Cloro","Arena"]},
    {q:"El cableado el√©ctrico debe ser revisado por:", a:"Electricista", o:["Plomero","Carpintero"]},
    {q:"¬øQu√© se usa para lijar madera?", a:"Lija", o:["Sierra","Martillo"]},
    {q:"Un extintor sirve para:", a:"Apagar fuego", o:["Regar plantas","Limpiar chimenea"]},
    {q:"¬øQu√© material a√≠sla el sonido?", a:"Espuma ac√∫stica", o:["Tela","Madera"]},
    {q:"¬øQu√© evita la corrosi√≥n met√°lica?", a:"Pintura anticorrosiva", o:["Aceite","Agua"]},
    {q:"¬øQu√© herramienta aprieta tornillos?", a:"Destornillador", o:["Martillo","Llave inglesa"]}
  ],
  "Social": [
    {q:"¬øQu√© es la empat√≠a?", a:"Ponerse en el lugar del otro", o:["Dar √≥rdenes","Ignorar emociones"]},
    {q:"¬øQu√© es la comunicaci√≥n asertiva?", a:"Expresar opiniones con respeto", o:["Gritar","Callar"]},
    {q:"Redes sociales sirven para:", a:"Conectar personas", o:["Aislar","Vender solo productos"]},
    {q:"Un l√≠der democr√°tico:", a:"Consulta al grupo antes de decidir", o:["Decide solo","Evita decisiones"]},
    {q:"Conflictos se resuelven mejor con:", a:"Di√°logo", o:["Violencia","Indiferencia"]},
    {q:"Trabajo en equipo requiere:", a:"Colaboraci√≥n", o:["Competencia","Desinter√©s"]},
    {q:"Normas sociales:", a:"Regulan convivencia", o:["Generan caos","Son opcionales"]},
    {q:"Feedback constructivo sirve para:", a:"Mejorar desempe√±o", o:["Criticar sin soluciones","Ignorar"]},
    {q:"Tolerancia es:", a:"Aceptar diferencias", o:["Imponer ideas","Rechazar"]},
  ],
  "Tecnolog√≠a": [
    {q:"¬øQu√© significa CPU?", a:"Unidad Central de Procesamiento", o:["Unidad de Potencia","Memoria principal"]},
    {q:"¬øQu√© es RAM?", a:"Memoria de acceso aleatorio", o:["Memoria fija","Almacenamiento √≥ptico"]},
    {q:"¬øQu√© protocolo se usa para p√°ginas web?", a:"HTTP/HTTPS", o:["FTP","SMTP"]},
    {q:"¬øQu√© hace un router?", a:"Conecta redes distintas", o:["Almacena archivos","Procesa datos"]},
    {q:"¬øQu√© significa HTML?", a:"Lenguaje de marcado de hipertexto", o:["Lenguaje de programaci√≥n","Base de datos"]},
    {q:"¬øQu√© SO es de c√≥digo abierto?", a:"Linux", o:["Windows","macOS"]},
    {q:"¬øQu√© es la nube inform√°tica?", a:"Servicios remotos en Internet", o:["App de clima","Red local"]},
    {q:"¬øPuerto por defecto de HTTP?", a:"80", o:["21","25"]},
    {q:"¬øQu√© es un algoritmo?", a:"Secuencia de pasos para resolver un problema", o:["Un programa","Un archivo"]}
  ],
  "Educativo": [
    {q:"¬øQu√© es aprendizaje activo?", a:"Participaci√≥n consciente del estudiante", o:["Escuchar pasivamente","Tomar apuntes sin pensar"]},
    {q:"La evaluaci√≥n formativa sirve para:", a:"Mejorar el aprendizaje", o:["Calificar sin ense√±ar","Ignorar progreso"]},
    {q:"Aprender jugando se llama:", a:"Gamificaci√≥n", o:["Memorizaci√≥n","Disciplina estricta"]},
    {q:"¬øQu√© es la lectura cr√≠tica?", a:"Analizar y reflexionar sobre textos", o:["Leer sin entender","Resumir sin pensar"]},
    {q:"Planificaci√≥n educativa:", a:"Organizar objetivos y actividades", o:["Improvisar","Ignorar recursos"]},
    {q:"M√©todo Montessori se centra en:", a:"Autonom√≠a del estudiante", o:["Memorizaci√≥n","Competencia"]},
    {q:"Aprendizaje colaborativo requiere:", a:"Trabajo en equipo", o:["Individualismo","Competencia"]},
    {q:"¬øQu√© es educaci√≥n inclusiva?", a:"Igualdad de oportunidades", o:["Separaci√≥n de estudiantes","Prioridad a unos"]},
    {q:"Evaluaci√≥n diagn√≥stica identifica:", a:"Fortalezas y debilidades", o:["Castigos","Desmotivaci√≥n"]}
  ],
  "Legal": [
    {q:"¬øQu√© es un contrato?", a:"Acuerdo legal entre partes", o:["Una carta","Un presupuesto"]},
    {q:"Propiedad intelectual protege:", a:"Ideas y creaciones", o:["Terrenos","Maquinaria"]},
    {q:"Un delito se denuncia en:", a:"Fiscal√≠a", o:["Hospital","Escuela"]},
    {q:"Ley de tr√°nsito regula:", a:"Seguridad vial", o:["Tr√°fico a√©reo","Consumo de alimentos"]},
    {q:"Derechos humanos garantizan:", a:"Libertad y dignidad", o:["Solo obligaciones","Solo trabajo"]},
    {q:"Un juez toma decisiones en:", a:"Juicio", o:["Colegios","Mercados"]},
    {q:"Un contrato laboral regula:", a:"Relaci√≥n empleador-empleado", o:["Relaci√≥n de amigos","Propiedad"]},
    {q:"La prescripci√≥n legal indica:", a:"Caducidad de derechos", o:["Inicio de contrato","Garant√≠as"]},
    {q:"¬øQu√© es tutela?", a:"Protecci√≥n legal de derechos fundamentales", o:["Un seguro","Una multa"]}
  ],
  "Alimentaci√≥n": [
    {q:"¬øQu√© es una dieta balanceada?", a:"Alimentos variados y proporciones correctas", o:["Solo prote√≠nas","Solo carbohidratos"]},
    {q:"Vitaminas esenciales:", a:"A, B, C, D y E", o:["F, G, H","X, Y, Z"]},
    {q:"El exceso de az√∫car puede causar:", a:"Diabetes y caries", o:["Mejora digesti√≥n","Fiebre"]},
    {q:"Hidrataci√≥n diaria recomendada:", a:"2 litros de agua aprox.", o:["500 ml","5 litros"]},
    {q:"Prote√≠nas se encuentran en:", a:"Carnes, huevos, legumbres", o:["Pan y galletas","Frutas"]},
    {q:"Fibra ayuda a:", a:"Regular intestinos", o:["Dormir mejor","Subir peso"]},
    {q:"Minerales importantes:", a:"Calcio, hierro, potasio", o:["Plomo, mercurio, cadmio","Cloro, fl√∫or, bromo"]},
    {q:"Evitar grasas trans ayuda a:", a:"Coraz√≥n saludable", o:["H√≠gado fuerte","Aumentar peso"]},
    {q:"Antioxidantes se encuentran en:", a:"Frutas y verduras", o:["Az√∫car","Sal"]}
  ],
  "Transporte": [
    {q:"¬øQu√© es transporte p√∫blico?", a:"Servicio colectivo de movilidad", o:["Veh√≠culo privado","Transporte ilegal"]},
    {q:"Licencia de conducir se obtiene:", a:"Tras aprobar examen oficial", o:["Por edad","Por inscripci√≥n en colegio"]},
    {q:"Sem√°foro rojo indica:", a:"Detenerse", o:["Avanzar","Ceder paso"]},
    {q:"Sem√°foro verde indica:", a:"Avanzar", o:["Detenerse","Reducir velocidad"]},
    {q:"¬øQu√© combustible usa un auto el√©ctrico?", a:"Electricidad", o:["Gasolina","Di√©sel"]},
    {q:"Se√±al de pare indica:", a:"Detenerse completamente", o:["Seguir","Reducir velocidad"]},
    {q:"Transporte ferroviario usa:", a:"Rieles", o:["Caminos","Aeropuertos"]},
    {q:"Autob√∫s articulado:", a:"Mayor capacidad de pasajeros", o:["Menor capacidad","No transporta personas"]},
    {q:"Carga peligrosa requiere:", a:"Se√±alizaci√≥n especial", o:["No se√±alizaci√≥n","Velocidad alta"]}
  ],
  "Otro": [
    {q:"¬øC√≥mo describir√≠as tu √°rea de conocimiento?", a:"Explicando con claridad", o:["Solo nombrando","Ignorando detalles"]},
    {q:"¬øQu√© tan seguro te sientes evaluando el tema?", a:"Con conocimiento suficiente", o:["Sin idea","Aleatoriamente"]},
    {q:"¬øQu√© recursos usar√≠as para investigar?", a:"Libros, internet o expertos", o:["Nada","Solo opiniones"]},
    {q:"¬øQu√© habilidad es clave?", a:"Razonamiento l√≥gico", o:["Memoria sin comprensi√≥n","Repetici√≥n mec√°nica"]},
    {q:"¬øC√≥mo organizas la informaci√≥n?", a:"De forma estructurada", o:["Al azar","Sin orden"]},
    {q:"¬øC√≥mo verificas la informaci√≥n?", a:"Comparando fuentes confiables", o:["Por intuici√≥n","Ignorando"]},
    {q:"¬øQu√© haces si hay dudas?", a:"Consulto expertos o investigo m√°s", o:["Dejo pasar","Supongo cualquier cosa"]},
    {q:"¬øQu√© herramienta usar√≠as?", a:"Software especializado o notas", o:["Nada","Cualquier cosa"]},
    {q:"¬øQu√© criterio usas para concluir?", a:"Basado en evidencia", o:["Opini√≥n propia","Sin evidencia"]}
  ]
};


    /* Estado */
    let currentStep = 0;
    let userData = {
      problem: "",
      topic: "",
      customTopic: "",
      knowledge: "",
      score: 0,
      causes: [],
      otherTopicsSaved: []   // para guardar lo que pongan en "Otro"
    };

    /* ======================
       Definici√≥n de pasos 
    ====================== */
    const steps = [
      {
        // Paso 0
        title: "Cu√©ntame tu problema",
        render: () => `
          <textarea id="problemInput" placeholder="Escribe aqu√≠ lo que te pas√≥..."></textarea>
        `
      },
      {
        // Paso 1
        title: "Relee tu problema con mucha atenci√≥n",
        render: (d) => `<p>${d.problem}</p>`
      },
      {
        // Paso 2
        title: "En base a esto, tu problema es de tipo (elige una sola opci√≥n):",
        render: () => `
          <div class="checkbox-group">
            ${topics.map(t => `
              <label><input type="radio" name="topic" value="${t}"> ${t}</label>
            `).join("")}
            <div id="customTopicDiv" style="display:none; margin-top:8px;">
              <input type="text" id="customTopicInput" placeholder="Especifica el t√≥pico" />
            </div>
          </div>
        `
      },
      {
        // Paso 3 - Evaluaci√≥n
        title: "Vamos a evaluar tu conocimiento",
        render: (d) => {
          if (d.topic === "De Salud") {
            return `
              <p>¬øPosee usted un t√≠tulo en medicina?</p>
              <label><input type="radio" name="med" value="Si"> S√≠</label>
              <label><input type="radio" name="med" value="No"> No</label>
            `;
          }
          if (d.topic === "Otro") {
            return `
              <p>¬øCree usted tener los conocimientos necesarios para analizar un problema de este tipo?</p>
              <label><input type="radio" name="otro" value="Si"> S√≠</label>
              <label><input type="radio" name="otro" value="No"> No</label>
            `;
          }
          const qs = questions[d.topic] || [];
          if (!qs.length) return `<p>No hay preguntas para este t√≥pico.</p>`;

          // Mezcla las opciones solo la primera vez que se renderiza este paso
          if (!shuffledOptions[d.topic]) {
            shuffledOptions[d.topic] = qs.map(q => {
              const opts = shuffle([q.a, ...q.o]);
              return opts;
            });
          }

          return qs.map((q, i) => {
            const opts = shuffledOptions[d.topic][i];
            return `
              <p>${q.q}</p>
              ${opts.map(opt => `
                <label><input type="radio" name="q${i}" value="${opt}"> ${opt}</label>
              `).join("")}
            `;
          }).join("");
        }
      },
      {
        // Paso 4 - Resultado de evaluaci√≥n
        title: "Resultado de tu evaluaci√≥n",
        render: (d) => `
          <p>${d.knowledge}</p>
          ${typeof d.score === 'number' && (d.topic !== "De Salud" && d.topic !== "Otro")
            ? `<p>Puntaje: <strong>${d.score}/9</strong></p>`
            : ``}
        `
      },
      {
        // Paso 5 - Edici√≥n
        title: "Revisemos de nuevo el problema",
        render: (d) => `
          <p class="hint">Si crees que te falt√≥ agregar alg√∫n detalle este es el momento. Edita tu texto abajo si lo necesitas.</p>
          <textarea id="problemEdit">${d.problem}</textarea>
        `
      },
      {
        // Paso 6 - Lectura final
        title: "Perfecto, ya casi terminamos",
        render: (d) => `
          <p>Aunque parezca repetitivo vamos a leer una √∫ltima vez lo que describiste. El objetivo de este software es hacerte pensar y repensar la situaci√≥n para no dejar ning√∫n detalle antes de aventurar conclusiones sobre las posibles causas.</p>
          <p style="margin-top:8px;"><strong>Tu descripci√≥n:</strong></p>
          <p>${d.problem}</p>
        `
      },
      {
        // Paso 7 - Causas
        title: "Ahora pensemos en las causas...",
        render: () => `
          <div class="cause-wrap">
            <p>Escribe cada causa por separado. Presiona <strong>Enter</strong> para guardarla. Al finalizar, usa "Siguiente".</p>
            <input type="text" id="causeInput" placeholder="Escribe una causa y presiona Enter" />
            <div id="savedBadge" style="display:none;" class="saved-badge">Causa agregada ‚úì</div>
            <div id="causeList" style="margin-top:10px;"></div>
          </div>
        `
      },
      {
        // Paso 8 - Lista final
        title: "Aqu√≠ est√°n las posibles causas",
        render: (d) => `
          <p>Comprueba si son las causas reales y ve eliminando las que no correspondan</p>
          ${
            d.causes.length
              ? d.causes.map((c,i) => `
                  <div class="cause-item">
                    <span>${c}</span>
                    <button onclick="deleteCause(${i})" aria-label="Eliminar causa ${i+1}">üóë</button>
                  </div>
                `).join("")
              : "<p>No ingresaste causas.</p>"
          }
        `
      }
    ];

    // A√±ade esta funci√≥n para mezclar arrays
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Guarda las opciones mezcladas para cada paso de preguntas
let shuffledOptions = {};

    /* ======================
       Render y navegaci√≥n
    ====================== */
    const titleEl = document.getElementById("title");
    const contentEl = document.getElementById("content");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");

    function renderStep() {
      const step = steps[currentStep];
      titleEl.textContent = step.title;
      contentEl.innerHTML = step.render(userData);

      prevBtn.disabled = currentStep === 0;
      nextBtn.textContent = currentStep === steps.length - 1 ? "Finalizar" : "Siguiente ‚û°Ô∏è";

      // Eventos espec√≠ficos por paso
      if (currentStep === 2) {
        // Toggle de "Otro"
        document.querySelectorAll('input[name="topic"]').forEach(radio => {
          radio.addEventListener("change", (e) => {
            const show = e.target.value === "Otro";
            const customDiv = document.getElementById("customTopicDiv");
            if (customDiv) customDiv.style.display = show ? "block" : "none";
          });
        });
      }

      if (currentStep === 7) {
        const input = document.getElementById("causeInput");
        const badge = document.getElementById("savedBadge");
        input.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            const val = input.value.trim();
            if (!val) return;
            userData.causes.push(val);
            input.value = "";
            renderCauses();
            // feedback visual
            if (badge) {
              badge.style.display = "inline-block";
              setTimeout(() => (badge.style.display = "none"), 900);
            }
          }
        });
        renderCauses();
      }
    }

    function renderCauses() {
      const list = document.getElementById("causeList");
      if (!list) return;
      list.innerHTML = userData.causes.map((c,i) => `
        <div class="cause-item">
          <span>${c}</span>
          <button onclick="deleteCause(${i})">üóë</button>
        </div>
      `).join("");
    }

    // Exponer funci√≥n de borrado para los botones
    window.deleteCause = function(i) {
      userData.causes.splice(i, 1);
      // Si estamos en la vista final (paso 8), re-render completo.
      if (currentStep === 8) {
        renderStep();
      } else {
        renderCauses();
      }
    };

    // Bot√≥n Siguiente
    nextBtn.addEventListener("click", () => {
      // Validaciones por paso
      if (currentStep === 0) {
        const val = (document.getElementById("problemInput")?.value || "").trim();
        if (!val) { alert("Por favor, escrib√≠ tu problema antes de continuar."); return; }
        userData.problem = val;
      }

      if (currentStep === 2) {
        const sel = document.querySelector('input[name="topic"]:checked');
        if (!sel) { alert("Seleccion√° un t√≥pico para continuar."); return; }
        userData.topic = sel.value;
        if (userData.topic === "Otro") {
          const custom = (document.getElementById("customTopicInput")?.value || "").trim();
          if (!custom) { alert("Especific√° el t√≥pico en 'Otro' para continuar."); return; }
          userData.customTopic = custom;
          // Guardamos en lista para investigar despu√©s
          if (!userData.otherTopicsSaved.includes(custom)) {
            userData.otherTopicsSaved.push(custom);
          }
        }
      }

      if (currentStep === 3) {
        if (userData.topic === "De Salud") {
          const med = document.querySelector('input[name="med"]:checked');
          if (!med) { alert("Respond√© la pregunta para continuar."); return; }
          userData.knowledge = med.value === "Si"
            ? "Si crees poseer el conocimiento para evaluar tu condici√≥n, prosigue al siguiente paso."
            : "Lo m√°s prudente en este caso ser√° que acudas con un profesional de la Salud.";
        } else if (userData.topic === "Otro") {
          const otro = document.querySelector('input[name="otro"]:checked');
          if (!otro) { alert("Respond√© la pregunta para continuar."); return; }
          userData.knowledge = otro.value === "Si"
            ? "Intentemos analizar el problema para buscar su causa en el siguiente paso."
            : "Ser√° mejor que consultes con alguien con m√°s experiencia antes de continuar.";
        } else {
          const qs = questions[userData.topic] || [];
          // Validar que todas tengan respuesta
          for (let i = 0; i < qs.length; i++) {
            const ans = document.querySelector(`input[name="q${i}"]:checked`);
            if (!ans) {
              alert("Por favor, responde todas las preguntas antes de continuar.");
              return;
            }
          }
          let score = 0;
          for (let i = 0; i < qs.length; i++) {
            const ans = document.querySelector(`input[name="q${i}"]:checked`);
            if (ans && ans.value === qs[i].a) score++;
          }
          userData.score = score;
          if (score < 5) {
            userData.knowledge = "Parece que necesitas m√°s conocimiento en esta √°rea para resolver el problema; te sugerimos investigar o consultar a una persona id√≥nea y luego volver a utilizar este programa.";
          } else if (score < 9) {
            userData.knowledge = "Pareces conocer sobre este tema; te invitamos a investigar un poco sobre la situaci√≥n que te pas√≥ y luego seguir con el pr√≥ximo paso para determinar las causas.";
          } else {
            userData.knowledge = "Se ve que est√°s bien instruido sobre este t√≥pico. Prosigue al siguiente paso.";
          }
        }
      }

      if (currentStep === 5) {
        const val = (document.getElementById("problemEdit")?.value || "").trim();
        if (val) userData.problem = val;
      }

      // Avance / Final
      if (currentStep < steps.length - 1) {
        currentStep++;
        // Ajuste de t√≠tulo din√°mico con el nombre del t√≥pico donde corresponda
        if (currentStep === 3 && userData.topic && userData.topic !== "De Salud" && userData.topic !== "Otro") {
          steps[3].title = `Vamos a evaluar tu conocimiento sobre "${userData.topic}" con unas preguntas r√°pidas`;
        } else {
          steps[3].title = "Vamos a evaluar tu conocimiento"; // reset por si vuelve atr√°s
        }
        renderStep();
        // scrollear arriba de la caja para que siempre se vea el principio del paso
        document.querySelector('.container')?.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        alert("¬°Proceso completado!");
      }
    });

    // Bot√≥n Atr√°s
    prevBtn.addEventListener("click", () => {
      if (currentStep > 0) {
        currentStep--;
        renderStep();
        document.querySelector('.container')?.scrollTo({ top: 0, behavior: 'smooth' });
      }
    });

    // Primer render
    renderStep();
  </script>
</body>
</html>
